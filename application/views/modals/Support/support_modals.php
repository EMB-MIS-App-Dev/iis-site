
<!-- for viewing support  ticket modal -->
<div class="modal fade" id="supp_view_ticket" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background-color:#FFF;"><span style="color:white!important">View Support</span>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color:#FFF;">
          <span aria-hidden="true" style="color:white!important">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-12">
                <label for="support_establishment">ESTABLISHMENT:</label>
                <span id="support_establishment">SAMPLEEEEEEEEEEEEEEEEE</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-6">
                <label for="support_system">SYSTEM:</label>
                <span id="support_system">INTEGRATED INFORMATION SYSTEM</span>
            </div>
            <div class="col-md-6">
              <label for="support_client_contact_no">CLIENT CONTACT #:</label>
              <span id="support_client_contact_no">09123232392039</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-6">
                <label for="support_date">DATE REQUESTED:</label>
                <span id="support_date">JULY 1 , 2020</span>
            </div>
            <div class="col-md-6">
                <label for="support_client_email">CLIENT EMAIL:</label>
                <span id="support_client_email">sample@email.gmail.com</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-6">
                <label for="support_system_inquiry">INQUERY:</label>
                <span id="support_system_inquiry">SAMPLE INQUIRY</span>
            </div>
            <div class="col-md-6">
                <label for="support_client_name">CLIENT NAME:</label>
                <span id="support_client_name">SAMPLE NAME</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <label for="support_remarks">REMARKS:</label>
          <textarea name="name" id="support_remarks" rows="4" style="width:100%"></textarea>
        </div>
        <div class="col-md-12">
          <div class="dropdown">
          <button style="    border: 1px solid;" class="btn dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span style='color:#104E91;'> --ATTACHMENTS--</span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="support_attachments_id"></div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- for viewing support  ticket modal -->
<div class="modal fade" id="res_supp_view_ticket" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background-color:#FFF;"><span style="color:white!important">View Support</span>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color:#FFF;">
          <span aria-hidden="true" style="color:white!important">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-12">
                <label for="res_support_establishment">ESTABLISHMENT:</label>
                <span id="res_support_establishment">SAMPLEEEEEEEEEEEEEEEEE</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-6">
                <label for="res_support_system">SYSTEM:</label>
                <span id="res_support_system">INTEGRATED INFORMATION SYSTEM</span>
            </div>
            <div class="col-md-6">
              <label for="res_support_client_contact_no">CLIENT CONTACT #:</label>
              <span id="res_support_client_contact_no">09123232392039</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-6">
                <label for="res_support_date">DATE REQUESTED:</label>
                <span id="res_support_date">JULY 1 , 2020</span>
            </div>
            <div class="col-md-6">
                <label for="res_support_client_email">CLIENT EMAIL:</label>
                <span id="res_support_client_email">sample@email.gmail.com</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-6">
                <label for="res_support_system_inquiry">INQUERY:</label>
                <span id="res_support_system_inquiry">SAMPLE INQUIRY</span>
            </div>
            <div class="col-md-6">
                <label for="res_support_client_name">CLIENT NAME:</label>
                <span id="res_support_client_name">SAMPLE NAME</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <label for="support_remarks">REMARKS:</label>
          <textarea name="name" id="res_support_remarks" rows="4" style="width:100%"></textarea>
        </div>
        <div class="col-md-12">
          <div class="dropdown">
          <button style="    border: 1px solid;" class="btn dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span style='color:#104E91;'> --ATTACHMENTS--</span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="res_support_attachments_id_1"></div>
          </div>
        </div>
        <hr>
        <div class="col-md-12">
          <label for="support_resolution">RESOLUTION:</label>
          <textarea name="support_resolution" id="res_support_resolution" rows="4" style="width:100%"></textarea>
        </div>
        <div class="col-md-12">
          <div class="dropdown">
          <button style="    border: 1px solid;" class="btn dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span style='color:#104E91;'> --RESOLUTION ATTACHMENTS--</span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="res_support_attachments_id"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="supp_add_resolution" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background-color:#FFF;"><span style="color:white!important">Add Resolution</span>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color:#FFF;">
          <span aria-hidden="true" style="color:white!important">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-12">
                <label for="support_establishment_res">ESTABLISHMENT:</label>
                <span id="support_establishment_res">SAMPLEEEEEEEEEEEEEEEEE</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-6">
                <label for="support_system_res">SYSTEM:</label>
                <span id="support_system_res">INTEGRATED INFORMATION SYSTEM</span>
            </div>
            <div class="col-md-6">
              <label for="support_client_contact_no_res">CLIENT CONTACT #:</label>
              <span id="support_client_contact_no_res">09123232392039</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-6">
                <label for="support_date_res">DATE REQUESTED:</label>
                <span id="support_date_res">JULY 1 , 2020</span>
            </div>
            <div class="col-md-6">
                <label for="support_client_email_res">CLIENT EMAIL:</label>
                <span id="support_client_email_res">sample@email.gmail.com</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-6">
                <label for="support_system_inquiry_res">INQUERY:</label>
                <span id="support_system_inquiry_res">SAMPLE INQUIRY</span>
            </div>
            <div class="col-md-6">
                <label for="support_client_name_res">CLIENT NAME:</label>
                <span id="support_client_name_res">SAMPLE NAME</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
                <label for="support_remarks_res">REMARKS:</label>
                <textarea name="" id="support_remarks_res" rows="4" style="width:100%"></textarea>
        </div>
        <hr>
        <form class="" action="<?php echo base_url(); ?>Support/Main_support/submit_resolution" method="post" enctype="multipart/form-data">
          <input type="hidden" name="supp_ticket_id_res" value="" id="supp_ticket_id_res">
          <div class="col-md-12">
            <label for="support_resolution">RESOLUTION:</label>
            <textarea name="support_resolution" id="support_resolution" rows="4" style="width:100%"></textarea>
          </div>
          <div class="col-md-12">
            <div class="row">
              <div class="form-group spattdropzone_dashboard" style="padding: 0px 0px 0px 10px;width: 100%;">
                <label>Attachment:</label><span class="set_note"> (max. 20mb / file)</span><br />
                <!-- <span class="set_note">* please upload attachment(s)</span> -->
                <span><span style="color:red">Note:</span> Please attach corresponding screenshot images for Errors or Bugs and other issues.</span>
                <div id="actions" class="row">
                    <div class="col-md-12">
                      <button type="button" class="btn btn-outline-primary btn-sm fileinput-button">
                        <i class="fas fa-plus-circle"></i>
                        <span>Add Files</span>
                      </button>
                      <button type="button" class="btn btn-outline-info btn-sm start">
                        <i class="fas fa-upload"></i>
                        <span>Upload All</span>
                      </button>
                      <button type="button" class="btn btn-outline-danger btn-sm cancel">
                        <i class="fas fa-times-circle"></i>
                        <span>Remove All</span>
                      </button>
                    </div>

                    <div class="col-lg-5">
                      <!-- The global file processing state -->
                      <span class="fileupload-process">
                        <div id="total-progress" class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                          <div class="progress-bar progress-bar-success" style="width:0%;" data-dz-uploadprogress=""></div>
                        </div>
                      </span>
                    </div>
                </div>

                <div class="table table-striped dropzone_table upload_div files" id="previews">
                    <div id="att_template_support" class="file-row dz-image-preview row">
                        <!-- file name, and error message -->
                        <div class="col-md-5">
                          <p class="name" data-dz-name></p>
                          <strong class="error text-danger" data-dz-errormessage></strong>
                        </div>
                        <!-- file size, and progress bar -->
                        <div class="col-md-4">
                          <p class="size" data-dz-size></p>
                          <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                            <div class="progress-bar progress-bar-success" style="width:0%;" data-dz-uploadprogress></div>
                          </div>
                        </div>
                        <!-- file upload, remove, and delete button -->
                        <div class="col-md-3">
                            <button type="button" class="btn btn-outline-info btn-sm start">
                              <i class="fas fa-upload"></i>
                            </button>
                            <button data-dz-remove type="button" class="btn btn-outline-warning btn-sm cancel">
                              <i class="fas fa-window-close"></i>
                            </button>
                            <button data-dz-remove type="button" class="btn btn-outline-danger btn-sm delete">
                              <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

              </div>
            </div>
          </div>
      </div>
      <div class="modal-footer">
          <button type="submit" class="btn btn-primary" >SUBMIT</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>
      </form>
    </div>
  </div>
</div>

<style media="screen">
div#supp_view_ticket span {
  color: black;
  font-weight: 600;
}
div#supp_view_ticket label {
    color: black;
}
</style>

<script type="text/javascript">
      Dropzone.autoDiscover = false;
      $(document).ready(function() {
        //Dropzone
        // Get the template HTML and remove it from the doumenthe template HTML and remove it from the doument
        var previewNode = document.querySelector("#att_template_support");
        previewNode.id = "";
        var previewTemplate = previewNode.parentNode.innerHTML;
        previewNode.parentNode.removeChild(previewNode);

        var myDropzone = new Dropzone("div.spattdropzone_dashboard", { // Make the whole body a dropzone
          url: "<?php echo base_url('Support/Main_support/fileUpload'); ?>", // Set the url
          params: {

          },
          maxFilesize: 20,
          parallelUploads: 20,
          timeout: 0,
          acceptedFiles: "image/*,application/pdf,.docx,.doc,.xlsx,.xls",
          previewTemplate: previewTemplate,
          autoQueue: false, // Make sure the files aren't queued until manually added
          previewsContainer: "#previews", // Define the container to display the previews
          clickable: ".fileinput-button" // Define the element that should be used as click trigger to select files.
        });


        myDropzone.on("addedfile", function(file) {
          // Hookup the start button
          file.previewElement.querySelector(".start").onclick = function() { myDropzone.enqueueFile(file); };
        });

        // Update the total progress bar
        myDropzone.on("totaluploadprogress", function(progress) {
          document.querySelector("#total-progress .progress-bar").style.width = progress + "%";
        });

        myDropzone.on("sending", function(file,xhr, formData) {

          formData.append('supp_ticket_id', jQuery('#supp_ticket_id_res').val());
          // formData.append('new_attch_token_per_reply', jQuery('#new_attch_token_per_reply_id').val());
          // Show the total progress bar when upload starts
          document.querySelector("#total-progress").style.opacity = "1";
          // And disable the start button
          file.previewElement.querySelector(".start").setAttribute("disabled", "disabled");
        });

        // Hide the total progress bar when nothing's uploading anymore
        myDropzone.on("queuecomplete", function(progress) {
          document.querySelector("#total-progress").style.opacity = "0";
        });

        // for deleting uploaded file
        myDropzone.on("success", function(file, response) {
          $(file.previewTemplate).append('<span class="server_file" style="display:none">'+response+'</span>');
          $('#client_sent_request_id_form').append('<input style="display:none" type="text" name="file_path[]" value='+response+'>');
        });
        myDropzone.on("removedfile", function(file) {
          var server_file = $(file.previewTemplate).children('.server_file').text();
          var base_url = '<?php echo base_url(); ?>';
          $.post(base_url+"Support/Main_support/removeuploadedfile", { file_to_be_deleted: server_file } );
        });

        // Setup the buttons for all transfers
        // The "add files" button doesn't need to be setup because the config
        // `clickable` has already been specified.
        document.querySelector("#actions .start").onclick = function() {
          myDropzone.enqueueFiles(myDropzone.getFilesWithStatus(Dropzone.ADDED));
        };
        document.querySelector("#actions .cancel").onclick = function() {
          myDropzone.removeAllFiles(true);
        };
        var length = 5;
        var result           = '';
        var characters       = '14387737324090904579831092390109823489894501020399782';
        var charactersLength = characters.length;
        for ( var i = 0; i < length; i++ ) {
           result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        var d = new Date();
        var y = d.getFullYear();
       $('#supp_ticket_id_res').val('EMB-'+y+'-'+result);
      });

</script>
